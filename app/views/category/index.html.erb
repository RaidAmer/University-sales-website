<h1>Category!</h1>

<div class="input-group mb-3">
  <input type="text" id="category-search" placeholder="Search categories..." class="form-control">
  <button id="category-search-button" class="btn btn-primary">Search</button>
</div>

<table class="table table-hover">
  <thead class="table-dark">
    <tr>
      <th>Name</th>
      <th>Image</th>
    </tr>
  </thead>

  <tbody id="category-table-body">
    <% @categories.each do |category| %>
      <tr>
        <td class="category-name">
          <%= link_to category.name, category_products_path(category) %>
        </td>
        <td>
          <% if category.icon.present? %>
            <%= image_tag category.icon, width: 100, height: 100, alt: "#{category.name} image" %>
          <% else %>
            <span>No image available</span>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<p id="no-categories-message" style="display: none; color: red;">No matching categories found.</p>


<p><%= link_to "Create New category", new_category_path %></p>
<p><%= link_to "Back", home_path %></p>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("category-search");
    const searchButton = document.getElementById("category-search-button");

    function performSearch() {
      const query = searchInput.value.toLowerCase().trim();
      const rows = document.querySelectorAll("#category-table-body tr");
      let matchCount = 0;

      console.log("Query:", query);

      rows.forEach(row => {
        const nameCell = row.querySelector(".category-name");
        const nameText = nameCell?.textContent.toLowerCase().trim() || "";
        const isMatch = nameText.includes(query);
        row.style.display = isMatch ? "" : "none";
        if (isMatch) matchCount++;
      });

      document.getElementById("no-categories-message").style.display = matchCount === 0 ? "block" : "none";
    }

    searchButton.addEventListener("click", performSearch);

    searchInput.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        performSearch();
      }
    });
  });
</script>