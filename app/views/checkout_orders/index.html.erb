<% if current_user.admin? || current_user.seller? %>
  <h1>Customer Orders</h1>
<% else %>
  <h1>My Orders</h1>
<% end %>

<table class='table table-hover'>
    <thead class='table-dark'>
        <tr>
            <th>Order</th>
            <th>Item</th>
            <th>Total Price</th>
            <th>Date</th>
            <th>Status</th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
    </thead>

    <tbody>
        <% @checkout_orders.each do |checkout_order| %>
            <tr>
                <td><%= checkout_order.id %></td>
                <td><%= checkout_order.order_items.first&.product&.name || "Unnamed Item" %></td>
                <td><%= number_to_currency((checkout_order.total_price * 1.07).round(2)) %></td>
                <td><%= checkout_order.order_date.strftime("%B %d, %Y") %></td>
                <td><%= checkout_order.status %></td>
                <td><%= link_to "View Order", checkout_order_path(checkout_order), class: 'btn btn-primary' %></td>
                <td>
                    <% if current_user == checkout_order.user && checkout_order.status == 'Pending' %>
                      <%= form_with url: confirm_delivery_checkout_order_path(checkout_order), method: :patch, local: true do %>
                        <div class="form-check">
                          <%= radio_button_tag "buyer_confirmed", "1", checkout_order.buyer_confirmed == true, class: "form-check-input", onchange: "this.form.submit();" %>
                          <%= label_tag "buyer_confirmed_1", "Delivered", class: "form-check-label" %>
                        </div>
                        <div class="form-check">
                          <%= radio_button_tag "buyer_confirmed", "0", checkout_order.buyer_confirmed == false, class: "form-check-input", onchange: "this.form.submit();" %>
                          <%= label_tag "buyer_confirmed_0", "Not Delivered", class: "form-check-label" %>
                        </div>
                      <% end %>
                    <% elsif checkout_order.cart_items.first&.product&.user == current_user && checkout_order.status == 'Pending' %>
                      <%= link_to "Delivered", mark_as_delivered_checkout_order_path(checkout_order), 
                          method: :patch, 
                          data: { confirm: "Are you sure your order was delivered?" },
                          class: 'btn btn-secondary' %>
                    <% end %>
                </td>
                <td>
                    <% if checkout_order.status == 'Pending' %>
                        <%= link_to "Cancel", cancel_checkout_order_path(checkout_order), 
                            method: :patch, 
                            data: { confirm: "Are you sure you want to cancel this order?" },
                            class: 'btn btn-danger' %>
                    <% end %>
                </td>
                <td>
                  <%= link_to "Delete", checkout_order_path(checkout_order), 
                      method: :delete, 
                      data: { turbo: false, confirm: "Are you sure you want to delete this order?" }, 
                      class: 'btn btn-danger' %>
                </td>
            </tr>
        <% end %>
    </tbody>
</table>

<%= link_to 'Clear All Orders', clear_all_checkout_orders_path, 
    method: :delete, 
    data: { confirm: "Are you sure you want to delete all your orders?" }, 
    class: 'btn btn-danger' %>